<script type="text/javascript">
    // Enable pusher logging - don't include this in production
    Pusher.log = function(message) {
      if (window.console && window.console.log) window.console.log(message);
    };

    // Flash fallback logging - don't include this in production
    WEB_SOCKET_DEBUG = true;

    var pusher = new Pusher('1e0a6ecb2d4cebfeb716');
    var channel = pusher.subscribe('room_<%= params[:room_id] %>');
    channel.bind('chat_messages_event', function(data) {
			$('#message_content').val('');
			var message = '<li>'+data.username+': '+data.content+'</li>';
			$("#chat_room").append(message);
    });
  </script>

<div class="chat_container">
	<p class="notice"> Welcome to the chat room <%= params[:room_id] %> <%= session[:username] %>! </p>
	<ul id="chat_room">
		<% if @messages.next_page %>
			<div class="prev">
				<%= link_to "load previous chat", 
					{ action: :index, params: { page: @messages.next_page } },
					remote: true
				%>
			</div>
		<% end %>
	  <%= render @messages.reverse %>
	</ul>
	 
  <%= form_for Message.new, url: room_messages_path(params[:room_id]), remote: true do |f| %>
	  <%= f.text_field :content %>
	  <%= f.submit "Send" %>
	<% end %>
</div>