<script type="text/javascript">
    var pusher = new Pusher('1e0a6ecb2d4cebfeb716');
    var channel = pusher.subscribe('<%= Rails.env %>_room_<%= params[:room_id] %>');
    channel.bind('<%= Rails.env %>_chat_messages_event', function(data) {
			var message = '<dt>'+data.username+'</dt><dd>'+data.content+'</dd>';
			$("#chat_room").append(message);
    });
  </script>

<div class="chat_container">
	<h3>Welcome to the chat room <%= params[:room_id] %> <%= session[:username] %>!</h3>
	<dl class="dl-horizontal" id="chat_room">
		<% if @messages.next_page %>
			<div class="prev">
				<%= link_to "load previous chat", 
					{ action: :index, params: { page: @messages.next_page } },
					remote: true
				%>
			</div>
		<% end %>
	  <%= render @messages.reverse %>
	</dl>
	 
  <%= form_for Message.new, url: room_messages_path(params[:room_id]), remote: true do |f| %>
	  <%= f.text_field :content %>
	  <%= f.submit "Send" %>
	<% end %>
</div>